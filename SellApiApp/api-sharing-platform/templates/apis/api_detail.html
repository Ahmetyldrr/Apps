{% extends 'base.html' %}

{% block title %}{{ api.name }} - API Detayı{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3>{{ api.name }}</h3>
                <span class="badge bg-primary">{{ api.user.username }}</span>
            </div>
            <div class="card-body">
                <h5>Açıklama</h5>
                <p>{{ api.description|linebreaks }}</p>
                
                <h5>Endpoint</h5>
                <div class="bg-light p-3 rounded">
                    <code>{{ api.endpoint }}</code>
                </div>
                
                <h5 class="mt-4">Kullanım Bilgileri</h5>
                <p><strong>Oluşturulma Tarihi:</strong> {{ api.created_at|date:"d/m/Y H:i" }}</p>
                <p><strong>Son Güncelleme:</strong> {{ api.updated_at|date:"d/m/Y H:i" }}</p>
            </div>
            <div class="card-footer">
                {% if user == api.user %}
                    <a href="{% url 'api-update-template' api.pk %}" class="btn btn-warning">Düzenle</a>
                    <a href="{% url 'api-delete-template' api.pk %}" class="btn btn-danger">Sil</a>
                {% endif %}
                <a href="{% url 'api-list-template' %}" class="btn btn-secondary">Geri Dön</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5>API Test Aracı</h5>
            </div>
            <div class="card-body">
                <form id="apiTestForm">
                    <div class="mb-3">
                        <label class="form-label">HTTP Method</label>
                        <select class="form-select" id="httpMethod">
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                            <option value="PUT">PUT</option>
                            <option value="DELETE">DELETE</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Headers (JSON)</label>
                        <textarea class="form-control" id="headers" rows="3" placeholder='{"Content-Type": "application/json"}'></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Body (JSON)</label>
                        <textarea class="form-control" id="requestBody" rows="4" placeholder='{"key": "value"}'></textarea>
                    </div>
                    <button type="button" class="btn btn-primary" onclick="testApi()">Test Et</button>
                </form>
                <div id="testResult" class="mt-3" style="display: none;">
                    <h6>Sonuç:</h6>
                    <pre id="resultContent" class="bg-light p-2 rounded"></pre>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function testApi() {
    const endpoint = '{{ api.endpoint }}';
    const method = document.getElementById('httpMethod').value;
    const headers = document.getElementById('headers').value;
    const body = document.getElementById('requestBody').value;
    
    let requestOptions = {
        method: method,
        headers: headers ? JSON.parse(headers) : {}
    };
    
    if (method !== 'GET' && body) {
        requestOptions.body = body;
    }
    
    fetch(endpoint, requestOptions)
        .then(response => response.text())
        .then(data => {
            document.getElementById('resultContent').textContent = data;
            document.getElementById('testResult').style.display = 'block';
        })
        .catch(error => {
            document.getElementById('resultContent').textContent = 'Hata: ' + error.message;
            document.getElementById('testResult').style.display = 'block';
        });
}
</script>
{% endblock %}
