<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeliÅŸmiÅŸ Arama - Ã‡oklu Tablo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 1400px; margin: 0 auto; }
        .search-header { text-align: center; margin-bottom: 30px; background: white; padding: 20px; border-radius: 10px; }
        .results-section { background: white; margin-bottom: 20px; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .results-section h3 { color: #495057; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 20px; }
        
        /* SonuÃ§ kartlarÄ± */
        .results-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .result-card { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; border-radius: 8px; }
        .result-card h4 { margin: 0 0 10px 0; color: #343a40; }
        .result-card p { margin: 5px 0; font-size: 0.9em; color: #6c757d; }
        .highlight { background-color: #fff3cd; padding: 2px 4px; border-radius: 3px; }
        
        /* Filtre bilgileri */
        .filter-info { background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .filter-info h4 { margin: 0 0 10px 0; color: #1565c0; }
        
        /* Ä°statistik kutularÄ± */
        .stats-summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-box { background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-number { font-size: 1.8em; font-weight: bold; display: block; }
        .stat-label { font-size: 0.9em; }
        
        /* BoÅŸ sonuÃ§ */
        .no-results { text-align: center; color: #6c757d; padding: 40px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="search-header">
            <h1>ğŸ” GeliÅŸmiÅŸ Arama SonuÃ§larÄ±</h1>
            <p>5 farklÄ± tablodan entegre arama sonuÃ§larÄ±</p>
        </div>

        <!-- Arama kriterleri bilgisi -->
        <div class="filter-info">
            <h4>ğŸ¯ Arama Kriterleri</h4>
            <p><strong>KullanÄ±lan Tablolar:</strong> League, Team, Match, Player, TeamStats</p>
            <p><strong>Arama TÃ¼rÃ¼:</strong> Ã‡oklu tablo entegre aramasÄ±</p>
            <p><strong>SÄ±ralama:</strong> Ä°liÅŸkisel verilere gÃ¶re optimize edilmiÅŸ</p>
        </div>

        <!-- Ã–zet istatistikler -->
        <div class="stats-summary">
            <div class="stat-box">
                <span class="stat-number">{{ matching_teams.count }}</span>
                <span class="stat-label">EÅŸleÅŸen TakÄ±m</span>
            </div>
            <div class="stat-box">
                <span class="stat-number">{{ matching_players.count }}</span>
                <span class="stat-label">EÅŸleÅŸen Oyuncu</span>
            </div>
            <div class="stat-box">
                <span class="stat-number">{{ matching_matches.count }}</span>
                <span class="stat-label">EÅŸleÅŸen MaÃ§</span>
            </div>
            <div class="stat-box">
                <span class="stat-number">{{ matching_leagues.count }}</span>
                <span class="stat-label">EÅŸleÅŸen Lig</span>
            </div>
        </div>

        <!-- BÃ–LÃœM 1: TAKIMLAR (Team + League + TeamStats tablolarÄ±) -->
        <div class="results-section">
            <h3>âš½ Bulunan TakÄ±mlar ({{ matching_teams.count }})</h3>
            <div class="results-grid">
                {% for team in matching_teams %}
                <div class="result-card">
                    <h4>{{ team.name }}</h4>
                    <p><strong>Lig:</strong> {{ team.league.name }} ({{ team.league.country }})</p>
                    <p><strong>Åehir:</strong> {{ team.city }}</p>
                    <p><strong>KuruluÅŸ:</strong> {{ team.founded_year|default:"Bilinmiyor" }}</p>
                    
                    <!-- TeamStats tablosundan gelen istatistikler -->
                    {% if team.teamstats_set.first %}
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #dee2e6;">
                        <p><strong>Ä°statistikler:</strong></p>
                        {% with stats=team.teamstats_set.first %}
                        <p>ğŸ† {{ stats.wins }}G {{ stats.draws }}B {{ stats.losses }}M</p>
                        <p>âš½ {{ stats.goals_for }}-{{ stats.goals_against }} ({{ stats.goal_difference|floatformat:0 }})</p>
                        {% endwith %}
                    </div>
                    {% endif %}
                </div>
                {% empty %}
                <div class="no-results">
                    <p>Arama kriterlerinize uygun takÄ±m bulunamadÄ±.</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- BÃ–LÃœM 2: OYUNCULAR (Player + Team tablolarÄ±) -->
        <div class="results-section">
            <h3>ğŸ‘¤ Bulunan Oyuncular ({{ matching_players.count }})</h3>
            <div class="results-grid">
                {% for player in matching_players %}
                <div class="result-card">
                    <h4>{{ player.name }} {{ player.surname }}</h4>
                    <p><strong>TakÄ±m:</strong> {{ player.team.name }}</p>
                    <p><strong>Lig:</strong> {{ player.team.league.name }}</p>
                    <p><strong>Pozisyon:</strong> {{ player.position }}</p>
                    <p><strong>YaÅŸ:</strong> {{ player.age }} yaÅŸÄ±nda</p>
                    {% if player.salary %}
                    <p><strong>MaaÅŸ:</strong> ${{ player.salary|floatformat:0 }}</p>
                    {% endif %}
                    <p><strong>TakÄ±m Åehri:</strong> {{ player.team.city }}</p>
                </div>
                {% empty %}
                <div class="no-results">
                    <p>Arama kriterlerinize uygun oyuncu bulunamadÄ±.</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- BÃ–LÃœM 3: MAÃ‡LAR (Match + Team + League tablolarÄ±) -->
        <div class="results-section">
            <h3>ğŸ Bulunan MaÃ§lar ({{ matching_matches.count }})</h3>
            <div class="results-grid">
                {% for match in matching_matches %}
                <div class="result-card">
                    <h4>{{ match.home_team.name }} vs {{ match.away_team.name }}</h4>
                    <p><strong>Tarih:</strong> {{ match.date|date:"d M Y H:i" }}</p>
                    <p><strong>Lig:</strong> {{ match.league.name }}</p>
                    
                    {% if match.home_score is not None %}
                        <p><strong>Skor:</strong> <span class="highlight">{{ match.home_score }} - {{ match.away_score }}</span></p>
                        <p><strong>Durum:</strong> TamamlandÄ±</p>
                    {% else %}
                        <p><strong>Durum:</strong> HenÃ¼z oynanmadÄ±</p>
                    {% endif %}
                    
                    <p><strong>Stadyum:</strong> {{ match.venue|default:"BelirtilmemiÅŸ" }}</p>
                    <p><strong>Ev Sahibi Åehir:</strong> {{ match.home_team.city }}</p>
                </div>
                {% empty %}
                <div class="no-results">
                    <p>Arama kriterlerinize uygun maÃ§ bulunamadÄ±.</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- BÃ–LÃœM 4: LÄ°GLER (League tablosu) -->
        <div class="results-section">
            <h3>ğŸ† Bulunan Ligler ({{ matching_leagues.count }})</h3>
            <div class="results-grid">
                {% for league in matching_leagues %}
                <div class="result-card">
                    <h4>{{ league.name }}</h4>
                    <p><strong>Ãœlke:</strong> {{ league.country }}</p>
                    <p><strong>Sezon:</strong> {{ league.season|default:"GÃ¼ncel" }}</p>
                    
                    <!-- Bu ligdeki takÄ±m sayÄ±sÄ± (iliÅŸkisel sorgu) -->
                    <p><strong>TakÄ±m SayÄ±sÄ±:</strong> {{ league.team_set.count }}</p>
                    
                    <!-- Bu ligdeki toplam maÃ§ sayÄ±sÄ± (iliÅŸkisel sorgu) -->
                    <p><strong>Toplam MaÃ§:</strong> {{ league.match_set.count }}</p>
                </div>
                {% empty %}
                <div class="no-results">
                    <p>Arama kriterlerinize uygun lig bulunamadÄ±.</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- BÃ–LÃœM 5: Ä°LÄ°ÅKÄ°SEL ANALÄ°Z -->
        <div class="results-section">
            <h3>ğŸ“Š Ä°liÅŸkisel Veri Analizi</h3>
            <div class="results-grid">
                <div class="result-card">
                    <h4>ğŸ”— Tablo Ä°liÅŸkileri</h4>
                    <p><strong>Toplam Lig:</strong> {{ matching_leagues.count }}</p>
                    <p><strong>Bu Liglerdeki TakÄ±mlar:</strong> 
                        {% for league in matching_leagues %}
                            {{ league.team_set.count }}
                            {% if not forloop.last %} + {% endif %}
                        {% endfor %}
                    </p>
                    <p><strong>Ä°statistik KaydÄ± Olan TakÄ±mlar:</strong> 
                        {{ matching_teams|length }}
                    </p>
                </div>
                
                <div class="result-card">
                    <h4>âš½ Oyuncu DaÄŸÄ±lÄ±mÄ±</h4>
                    {% for team in matching_teams|slice:":5" %}
                    <p><strong>{{ team.name }}:</strong> {{ team.player_set.count }} oyuncu</p>
                    {% endfor %}
                    {% if matching_teams.count > 5 %}
                    <p><em>... ve {{ matching_teams.count|add:"-5" }} takÄ±m daha</em></p>
                    {% endif %}
                </div>
                
                <div class="result-card">
                    <h4>ğŸ† MaÃ§ Ä°statistikleri</h4>
                    <p><strong>Tamamlanan MaÃ§lar:</strong> 
                        {{ matching_matches|length }}
                    </p>
                    <p><strong>Gelecek MaÃ§lar:</strong> 
                        YaklaÅŸan tarihlerde
                    </p>
                    <p><strong>FarklÄ± Stadyumlar:</strong> 
                        {% regroup matching_matches by venue as venue_list %}
                        {{ venue_list|length }}
                    </p>
                </div>
            </div>
        </div>

        <!-- NAVÄ°GASYON -->
        <div class="results-section">
            <h3>ğŸ”— DiÄŸer Sayfalar</h3>
            <p><a href="/">ğŸ  Ana Sayfa</a> - Temel Ã§oklu tablo gÃ¶rÃ¼nÃ¼mÃ¼</p>
            <p><a href="/dashboard/">ğŸ“ˆ Dashboard</a> - KapsamlÄ± analitik veriler</p>
            <p><a href="/admin/">âš™ï¸ YÃ¶netim</a> - Veri dÃ¼zenleme</p>
        </div>

        <!-- TEKNÄ°K BÄ°LGÄ°LER -->
        <div class="results-section" style="background: #f8f9fa; border: 1px dashed #6c757d;">
            <h3>ğŸ› ï¸ Teknik Detaylar</h3>
            <p><strong>Bu sayfa aÅŸaÄŸÄ±daki Django Ã¶zelliklerini gÃ¶steriyor:</strong></p>
            <ul>
                <li><strong>select_related():</strong> Team-League, Player-Team iliÅŸkileri tek sorguda</li>
                <li><strong>prefetch_related():</strong> Ters iliÅŸkiler (team.player_set) optimize edildi</li>
                <li><strong>Annotations:</strong> Ä°statistiksel hesaplamalar sorgu seviyesinde</li>
                <li><strong>Q Objects:</strong> Kompleks arama filtreleri</li>
                <li><strong>Template Filters:</strong> Veri formatlama ve sunum</li>
                <li><strong>HTML Sections:</strong> Her tablo verisi ayrÄ± bÃ¶lÃ¼mde organize edildi</li>
            </ul>
        </div>

    </div>
</body>
</html>
